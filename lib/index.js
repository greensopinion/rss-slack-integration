// Generated by CoffeeScript 1.12.7
(function() {
  var Watcher, request;

  Watcher = require('rss-watcher');

  request = require('request');

  exports.start = function(config) {
    var sendSlackNotification, watcher;
    watcher = new Watcher(config.feed);
    watcher.set({
      feed: config.feed,
      interval: config.interval
    });
    sendSlackNotification = function(prefix, article) {
      return request.post({
        url: config.slackHook,
        body: JSON.stringify({
          "username": config.slackBotUser,
          "text": prefix + ": <" + article.link + "|" + article.title + ">",
          "icon_url": config.slackIcon
        }),
        headers: {
          "Content-Type": "application/json"
        }
      });
    };
    watcher.on("new article", function(article) {
      return sendSlackNotification("New post", article);
    });
    watcher.on("updated article", function(article) {
      return sendSlackNotification("Updated post", article);
    });
    return watcher.run(function(error, articles) {
      return console.log("Started watching rss feed.");
    });
  };

}).call(this);
